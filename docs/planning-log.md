# 企画議論ログ v3（Planning Log v3）

> v2ドキュメント群に対する5人のAIエージェントチームによる深掘りレビュー・ディベート・改善プロセスの全記録

## チームメンバー

| 名前 | 役割 | 特徴 | 口癖 |
|------|------|------|------|
| **STRAT** | 市場戦略家 | データドリブン、確率論的思考 | 「エッジはどこにあるか？」 |
| **QUANT** | シグナル設計者 | 定量的、アルゴリズム的 | 「それはバックテストで検証できるか？」 |
| **RISK** | リスク管理者 | 最悪ケースを常に想定する悲観主義 | 「最悪のシナリオは？」 |
| **ARCH** | システム設計者 | 実装の現実性を重視するプラグマティスト | 「それ、実装できる？」 |
| **DEVIL** | 反論者 | 他の4人の提案に穴を突く | 「それ、本当？なぜそう言える？」 |

---

## レビュー概要

- **レビュー対象**: `docs2/strategy.md`, `docs2/system-design.md`, `docs2/action-plan.md`, `docs2/planning-log.md` および v2の各レビューファイル
- **レビュー日**: 2026-02-11
- **目的**: v2で整備された骨格に対し、各メンバーが「設計と実装の隙間」「パラメータの根拠」「持続可能性」を深掘りし、v3改善案を策定する

---

## セクション1: v1→v2議論サマリー（前回の振り返り）

v1では5人のAIエージェントチームが初期設計を策定し、v2ではそのレビューと改善を行った。以下はv2で合意された主要変更点の要約である。

### v1→v2の主要合意事項

1. **alpha仮説の事前検証（Phase 0）の追加**: コードを書く前にLLMセンチメントの予測力をテストする。方向予測精度60%未満なら戦略再設計。過去決算100件以上でテストし、FinBERT/VADERとの比較を実施。

2. **検証期間の延長**: 3ヶ月100取引から最低6ヶ月200取引以上へ。月次チェックポイントで中間評価。DEVILの12ヶ月要求とARCHのモチベーション懸念の間で折衷。

3. **リターン目標の引き下げ**: 年率15%（v1）から年率8-12%（v2）へ。全員一致で非現実的と判断。シャープレシオも段階的目標（0.3→0.5→0.8→1.0）に変更。

4. **銘柄ユニバースの段階的拡大**: 20-30銘柄から30銘柄スタート→段階的拡大（最大80銘柄）へ。シグナル頻度の確保と品質のバランス。

5. **マクロレジームモデルの拡張**: 2変数（200日MA+VIX）から4変数（+イールドカーブ+クレジットスプレッド）へ。

6. **リスク管理の強化**: 1トレードリスク1.5%→1.0%、回路ブレーカー閾値調整（L1:4%, L2:7%）、スリッページバッファ30%、ブラケット注文（OTO）による自動ストップロス。

7. **インフラの段階的移行**: macOS cron → launchd → VPS → クラウド。全Python化、冪等性確保（3重防御）、Reconciliationパターン。

8. **テスト・品質保証**: 3層テスト戦略+CI/CD。リスク管理モジュールのカバレッジ95%以上。

9. **ペーパー→リアル再現率**: 70-80%（v1）から50-70%（v2）へ引き下げ。Stage 1を2ヶ月に延長。逆戻り条件の設定。

### v2で残された課題

1. LLMモデル変更への対応策の具体化
2. 決算期間外の運用方針（Option A vs Option B）
3. 税務戦略
4. PDTルール対応
5. 企業アクション対応
6. コスト上限と自動停止メカニズム
7. バーンアウト対策

---

## セクション2: v2→v3議論記録

### 各メンバーのv2レビュー概要

v3のレビューでは、v2で「骨格は整った」との共通認識のもと、各メンバーが「設計と実装の隙間」を埋めることに注力した。

**【STRAT】** v2で骨格は整った。v3ではエッジの持続可能性と実装精度を追求する。特にPhase 0の実行プロトコル精緻化、alpha decay（エッジ消失速度）の定量モデル、銘柄ユニバース拡大の判断基準を掘り下げた。

**【QUANT】** v2で測定基盤の設計は整った。v3では検証プロトコルの具体化と統計的厳密性を追求する。Phase 0バックテストのPythonコード骨格、比較実験プロトコル、PurgedTimeSeriesSplit、ベイズ推定の実装詳細、BH法によるFDR制御、相互情報量分析を提案した。

**【RISK】** v2で多層防御の骨格は整った。v3では防御の盲点と動的リスク管理を追求する。ギャップリスクの確率分布モデル、EWMA動的相関、5つのヒストリカルシナリオのストレステスト、limit付きstop orderの乖離幅設計を掘り下げた。

**【ARCH】** v2で構造的弱点は解消された。v3では「動くシステム」から「安心して運用できるシステム」への品質向上に焦点を当てる。型安全なインターフェース設計、Claude CLI出力のJSON Schema Validation、Phase 0検証ツールキット、Observabilityを提案した。

**【DEVIL】** v2は改善されたが、改善自体が新たなリスクを生んでいる。3つの根本的問題を指摘: (1) 複雑性の爆発（178h開発+39h/月の維持）、(2) 合意の質（段階的妥協は問題の先送り）、(3) Go/No-Go基準60%の甘さ（コスト込みでマイナスリターン）。

---

## セクション3: 主要ディベート

### ディベート1: Go/No-Go閾値 -- 60% vs 65%

| | 60%維持派 | 65%引き上げ派 |
|---|---|---|
| **メンバー** | （なし） | DEVIL, STRAT（条件付き）, QUANT（条件付き） |

**【DEVIL】** 60%の方向性精度では取引コスト控除後にリターンがマイナスになる。計算する。方向性精度60%、平均利益4.5%、平均損失3.9%（スリッページ込み）、年間50トレードの場合、期待年率リターンは約1.46%。ここから取引コスト（スプレッド+スリッページ）年率0.5%とAPIコスト年率2.4%（$10,000資金の場合）を差し引くと、**-1.4%のマイナスリターン**だ。60%でGoは「損をしながら12ヶ月走り続ける」ことを意味する。

**【STRAT】** DEVILの計算は妥当だが、Phase 0の100件テストで精度60%だった場合、信頼区間は[50%, 70%]。真の精度が65%以上である可能性もある。Phase 0検証で精度を確認してから閾値を確定すべきだ。ただし、時間バイアス検定（LLMの事前知識汚染の検出）を行い、補正後の精度で判断することが前提。

**【QUANT】** DEVILの指摘に同意する面がある。ベイジアン推定を使う場合、事前分布の感度分析が必要だ。4つの事前分布（懐疑的/中立的/楽観的/コスト調整済み）で事後確率を比較し、全てでGoとなることを要求すべき。100件では検出力が不足する可能性があり、200件への拡大も検討すべき。

**【RISK】** 最悪のシナリオは、60%でGoと判断して12ヶ月運用し、結局マイナスリターンだったケース。Go基準は「損をしない最低ライン」であるべきだ。

**【ARCH】** 閾値の変更は実装に影響しない。config.tomlの1行。ただし、Phase 0のデータ収集・分析パイプラインは閾値に関わらず必要。

**結論**: Go基準を**65%以上**に引き上げる。Go/No-Go判断マトリクスを以下のように改定:

| LLM精度 | vs FinBERT差 | 判断 |
|---------|-------------|------|
| >= 65% | >= +5pp | Go（確信的） |
| >= 65% | < +5pp | 条件付Go: 追加100件で再検証 |
| 60-64% | >= +5pp | 条件付Go: 追加100件で再検証 |
| < 60% | any | No-Go |

加えて、全てのGo判定において**「取引コスト込みネットリターンがプラスであること」**を数式で確認する追加条件を設ける。DEVILの提案した「条件付き続行ゾーンの廃止」は一部受け入れ、2回目の条件付きもGoにならない場合はNo-Goとする。

---

### ディベート2: 統計的検証手法の高度化

| | 現行維持派 | 高度化推進派 |
|---|---|---|
| **メンバー** | （なし） | QUANT（主導）, DEVIL（条件付き）, STRAT |

**【QUANT】** v2でBonferroni補正のみが採用されているが、これは最も保守的な多重比較補正であり、Type IIエラー（見逃し）を増大させる。Benjamini-Hochberg（BH）法によるFDR制御への移行を提案する。BH法は「検出された改善のうち偽陽性の割合」を制御するもので、Bonferroniの「1つでも偽陽性が出る確率」よりも検出力が高い。

さらに、時系列クロスバリデーションにはPurgedTimeSeriesSplitを導入すべきだ。金融時系列CVではデータリーケージ防止のためパージ期間とエンバーゴ期間が必須（Lopez de Prado, 2018）。パージ10日、エンバーゴ5日を推奨する。

ベイズ推定についてはBayesianSharpeEstimatorクラスの具体的実装を提案する。共役事前分布（正規-正規モデル）で解析的に事後分布を算出し、MCMCは不要。

シグナル間の相互情報量（Mutual Information）分析も追加すべきだ。テクニカルフィルターの3条件がLLMセンチメントと冗長であれば、フィルターを除外してシグナル数を改善できる。

**【DEVIL】** BH法もPurgedTimeSeriesSplitもベイズ推定も方向性は正しい。ただし、ベイズ事前分布の恣意性に警告する。Normal(0, 0.5)の根拠が薄い。標準偏差0.3なら事前が強すぎて少ないデータでは事前分布に引きずられ、1.0なら弱すぎてほぼ無情報事前分布になる。**4つの事前分布（懐疑的Normal(0, 0.3)、中立的Normal(0, 0.5)、楽観的Normal(0.2, 0.7)、コスト調整済みNormal(-0.3, 0.5)）**で感度分析を行い、全てでP(SR>0.5)>90%の場合にのみリアル移行を許可すべき。

**【STRAT】** QUANTの提案は学術的に正しいが、実用性とのバランスが重要。MI分析は追加コスト$0でPhase 0のデータを再利用でき、フィルター設計を証拠に基づいて最適化できる点で優れている。ただし、初期段階では等重み（tech_scoreの各コンポーネント均等）で始め、6ヶ月運用後にデータに基づいて調整するのが安全だ。

**結論**: 以下の統計的検証手法を段階的に導入する:

1. **BH法FDR制御**: Bonferroniに替えてBH法を採用。FDR水準alpha=0.10。Phase 1から適用
2. **PurgedTimeSeriesSplit**: パージ10日、エンバーゴ5日。Phase 0のバックテストから適用
3. **ベイズ推定**: 月次レポートに4つの事前分布での感度分析を必須で含める。事前分布の選択で結論が変わるうちはデータ不足と判断（DEVIL提案を採用）
4. **相互情報量分析**: Phase 0の4,000件データで実施。CMI(tech|LLM)≒0のテクニカル指標はフィルターから除外を検討
5. **McNemar検定**: モデル間比較にカイ二乗検定だけでなくMcNemar検定を採用（ペアデータ比較に最適）

---

### ディベート3: アルファ減衰（Alpha Decay）への対応

| | エッジ楽観派 | エッジ悲観派 |
|---|---|---|
| **メンバー** | （なし -- 全員がリスクを認識） | STRAT（定量管理）, DEVIL（存在的リスク）, QUANT（検出手法） |

**【STRAT】** LLMセンチメントのエッジは時間とともに確実に消失する。これは「もし」ではなく「いつ」の問題。alpha decayを駆動するメカニズムは4つ: (1) 参加者増加、(2) LLMの一般化（同一プロンプトで同一出力）、(3) HFTによるfront-running、(4) PEADの縮小トレンド（McLean & Pontiff 2016: 論文発表後にアノマリーのリターンが58%縮小）。

対策として「Edge Half-Life推定」を提案する。月次精度トラッキングを初月から開始し、3ヶ月移動平均の低下トレンドを検出する。半減期が12ヶ月未満と推定された場合、プランCに移行する。

**プランC（v3新規）**: LLMの役割を「エントリーシグナル」から「リスクフィルター」に転換する。テクニカル/モメンタムでエントリー候補を選定し、LLMは「ネガティブリスクの有無」のスクリーニングに使用。コモディティ化された「ポジティブ/ネガティブ」判定から脱却し、「コンセンサスとの乖離度」「一時的要因vs構造的要因の判別」等の特化型プロンプトに進化させる。

**【DEVIL】** alpha decayは「注意書き」で済ませる問題ではなく、プロジェクトの存在意義に関わる。2026年2月時点でChatGPTの月間アクティブユーザーは推定2億人以上、Bloomberg Terminalは既にAI搭載センチメント分析を標準提供、QuantConnectにはLLMトレーディング戦略のオープンソース実装が多数公開されている。

LLMセンチメントのエッジは「精度」の問題ではなく「同じ公開情報を同じ品質で分析する競合が増える」構造的問題だ。**LLMの価値は「正確さ」ではなく「コンセンサスとの差異」にある**。フォールバック戦略をPhase 0と同時に設計すべき。

**【QUANT】** 相互情報量（Mutual Information）分析でalpha decayを定量的に検出できる。MI(LLM_sentiment, return_5d)を月次で追跡し、MIの低下はエッジの消失を示す。Phase 0の4,000件データで初期ベースラインを設定し、運用開始後は月次更新で監視する。

**結論**:

1. **Alpha Decayモニタリングフレームワーク**: 月次精度トラッキングを初月から稼働。3ヶ月移動平均が2ヶ月連続低下でAlpha Decay Warning、Phase 0基準に到達でAlpha Decay Critical
2. **Edge Half-Life推定**: 6ヶ月データ蓄積後に初回実施。半減期<12ヶ月ならプランCへの移行を開始
3. **プランC**: LLMをリスクフィルターに転用。コンセンサス乖離型プロンプトへの進化。マルチモデルアンサンブル（Claude + GPT + Gemini）の検討
4. **プランBのプロトタイプ**: Phase 0と同時にテクニカルのみ戦略のバックテストを実施（DEVIL提案を採用）

---

### ディベート4: 複雑性 vs 完全性 -- 個人開発者の限界

| | 完全性重視派 | MVP（最小限）派 |
|---|---|---|
| **メンバー** | RISK, QUANT | DEVIL（主導） |
| **中立** | STRAT, ARCH |

**【DEVIL】** v2は「やるべきことのリスト」としては正しいが、「できることのリスト」としては非現実的だ。実装工数を見積もる。4変数マクロモデル(8h)、セクター間相関マトリクス(12h)、ベイズ事後分布更新(16h)、Plattキャリブレーション(8h)、ウォークフォワードバックテスト(24h)、ブートストラップ法(4h)、Reconciliation(12h)、3重冪等性防御(8h)、ブラケット注文+Partial Fill(16h)、Slackアラート(8h) -- 合計**開発178時間 + テスト62時間**。月次維持に**39時間/月**（月次チェックポイント4h、キャリブレーション2h、相関マトリクス2h、ベイズ更新2h、戦略改善8h + 基本維持21h）。**副業としても重い。**

v1の「シンプルだが穴がある」設計は、v2で「理想的だが実装しきれない」設計に変わった。実装しきれない機能は存在しないのと同じだ。

**【RISK】** リスク管理機能は削減不可。ストップロス、回路ブレーカー、ポジションサイズ制限は「なければ死ぬ」機能であり、MVP化の対象にすべきでない。ギャップリスクモデルと動的相関管理は後回しにできるが、基本的な多層防御は初日から必要。

**【ARCH】** 型安全設計（types.py + Protocol）は初期投資が極小（1ファイル）で、見返りはプロジェクト全期間に渡る。後から導入するとモジュール全体の改修が必要。Phase 1の初期段階で定義すべき。一方、Observability（構造化ログ、メトリクス収集）は段階的に導入可能。

**【STRAT】** エッジの検証が最優先。Phase 0でGo/No-Goが出るまでは、シグナル設計と検証パイプラインに集中すべき。マクロレジームの重み最適化やテイクプロフィットのA/Bテストは運用データが蓄積されてから。

**【QUANT】** Phase 0バックテストのコード骨格とMI分析は「必須」。ベイズ推定の感度分析も「必須」。ただし、Plattキャリブレーションは運用開始後のデータが必要なので、初期段階ではキャリブレーションなしで運用しデータ蓄積のみでよい。

**結論**: v2の機能を**「必須（Phase 1）」「追加（Phase 3）」「リアル移行時」**の3段階に分類:

**Phase 1必須（MVP）**:
- 基本的なリスク管理（ストップロス、回路ブレーカー、ポジションサイズ制限）
- 型安全インターフェース（types.py）
- Phase 0検証パイプライン（コード骨格+データ収集+Go/No-Go判定）
- 冪等性確保（3重防御）
- Reconciliation
- 2変数マクロモデル（200日MA + VIX）で開始
- 同一セクター2銘柄制限（相関マトリクスの簡易代替）
- Claude CLI出力のJSON Schema Validation
- ブートストラップ法によるリアル移行判断

**Phase 3追加**:
- 4変数マクロモデルへの拡張
- セクター間相関マトリクス（EWMA動的相関）
- ベイズ事後分布更新（感度分析付き）
- Plattキャリブレーション
- MI分析によるフィルター最適化
- Observability（メトリクス収集+週次ダッシュボード）

**リアル移行時追加**:
- 段階的厳格化された回路ブレーカー
- テールリスクヘッジ（SPYプット）のコスト分析
- WebSocket API（VPS移行後）
- クラウド移行（EventBridge）

---

### ディベート5: リスク管理の高度化

| | パラメータ精緻化派 | 実用主義派 |
|---|---|---|
| **メンバー** | RISK（主導）, STRAT | ARCH, DEVIL |

**【RISK】** v2のスリッページバッファ30%は「根拠のない安全マージン」だ。実際のギャップダウン分布はファットテールであり、決算発表後、FOMC、地政学イベントではそれぞれ分布が異なる。Phase 0の4,000件データからギャップ分布を推定し、イベント種別ごとのスリッページ係数テーブル（決算通常1.5-2.0、決算サプライズ2.0-3.0、FOMC/CPI 1.2-1.5、地政学3.0-5.0、通常日1.1-1.2）を設定すべき。

動的相関管理について、月次更新の静的相関では「危機の瞬間に相関が1.0に収束する」問題に対処できない。EWMA相関（指数加重移動平均、lambda=0.94のRiskMetrics方式）による日次更新と、相関ブレイクアウト警告（20日ローリング相関の+2σ超過でアラート）を導入すべき。相関レジーム分類（低相関/高相関/超高相関）に応じたポジション上限の動的切り替えも必要。

ストレステストについて、v2の4シナリオは仮定ベースであり、5つのヒストリカルイベント（2020年3月COVID-19、2022年インフレショック、2023年SVB危機、2024年8月円キャリーアンワインド、2010年フラッシュクラッシュ）で実データ再現テストを実施すべき。

**【STRAT】** マクロレジーム判定との統合が重要。VIX閾値は固定値（20/30）だけでなく、VIXの60日移動平均比（相対VIX）とVIX変化率を考慮すべき。VIX/VIX3Mレシオ>1.0（バックワーデーション）はストレスの先行指標として活用できる。

**【ARCH】** Observabilityで実運用時の監視を補完する。Claude CLIレスポンス時間、API呼び出し回数、シグナル頻度、フィルター通過率等のメトリクスをSQLiteに記録し、閾値ベースの異常検知を実装する。週次ダッシュボードで傾向を可視化。

**【DEVIL】** 過剰な安全策もコストだ。VIX連動ポジション制限で2022年のように年間を通じてVIX 20-30が続く年には、ほぼ常に3ポジション制限。5ポジション前提の年率8-12%が年率5-7%に低下し、SPYに劣後する。「リスク管理の仕組みが戦略を殺す」パターンを意識すべき。VIX閾値の感度分析（パターンA: 18/28、B: 20/30、C: 22/35、D: 25/40）を過去10年データで行い、機会損失とリスク削減効果を定量比較せよ。

**結論**:

1. **ギャップリスク**: Phase 0データからギャップ分布を推定し、イベント種別ごとの係数テーブルをconfig.tomlに設定。一律30%は暫定値として維持するが、データに基づいて校正する
2. **動的相関**: Phase 1-2はセクター2銘柄制限（MVP）。Phase 3以降でEWMA動的相関を導入し、静的 vs EWMAの事後比較で追加的価値を確認
3. **ストレステスト**: Phase 0と並行して5シナリオの実データ再現テストを実施。結果に基づき回路ブレーカー閾値をキャリブレーション。成果物: docs/stress-test-results.md
4. **VIX閾値**: 過去10年データで感度分析を実施。固定閾値に加えて相対VIX（VIX/60日MA）の導入を検討。VIXスパイク条件（日次変化率>50%で即時新規禁止）を追加
5. **段階的撤退**: 機械的なスコアリングアルゴリズム（保有期間、含み損、セクター重複、センチメント転換の4要素）で縮小対象を決定。人間の判断もLLMの判断も排除

---

### ディベート6: Phase 0の設計と実行

| | プロトコル精緻化派 | 実行速度重視派 |
|---|---|---|
| **メンバー** | STRAT, QUANT, ARCH | DEVIL（条件付き） |

**【STRAT】** Phase 0の実行品質がプロジェクト全体の方向を決定する。v2のPhase 0は「何をやるか」は書かれているが「どうやるか」が不十分。以下の5点を精緻化すべき:

1. **時間バイアスの検出**: LLMのトレーニングデータに過去の決算結果が含まれている場合、精度が過大評価される。直近1週間の決算20件と過去6ヶ月100件の精度を比較し、有意差（>10pp）があれば時間バイアスの存在を示唆。補正精度 = 過去精度 - (過去精度 - 直近精度) * 0.5
2. **層化サンプリング**: 100件を11セクター x 各9件で層化抽出。ランダム選定ではサンプリングバイアスが発生
3. **プロンプトのバージョンロック**: Phase 0で使うプロンプトと本番プロンプトを同一にする。異なるとphase 0の検証結果が本番に適用できない
4. **Go/No-Go判断の境界ケースルール**: 精度が閾値ギリギリ（65.0%）の場合の判断ルールを事前に文書化
5. **データソースの統一**: SEC EDGAR（10-Q/10-K）+ Alpaca News API（プレスリリース）。M&A発表と同日の銘柄は除外（ノイズ排除）

**【QUANT】** Phase 0のPythonコード骨格を先に構築すべき。データ収集→ラベリング→LLMバッチ実行→ベースライン比較→統計検定→レポート生成のパイプラインを具体的に設計した。コスト見積もり: パイロット100件は$3-5、フル4,000件は$130-150。

比較実験プロトコル: 全モデルに同一ニューステキストを入力。FinBERTは512トークンに切断（モデル特性として記録）。McNemar検定でペアワイズ比較。LLMプロンプトは3種類（簡潔版/詳細版/Chain-of-Thought版）用意し、全てでFinBERT/VADERを上回ることを要求。

**【ARCH】** Phase 0検証ツールキット（Phase0Pipelineクラス）を提案。リジューム対応のバッチ実行パイプライン、50件ごとのJSON中間保存、Go/No-Goレポートの自動生成を含む。データベースにsentiment_resultsテーブルを作成し、既に処理済みのイベントはスキップ（リジューム機能）。

**【DEVIL】** Phase 0自体が目的化するリスクがある。パイロット100件で方向性を確認し、精度55%未満なら4,000件フルテストに進む意味はない。2週間の期限を設定し、Phase 0が延々と続くことを防止すべき。

**結論**:

1. **Phase 0実行プロトコル**: STRATの5点を全て採用。特に時間バイアス検定は省略不可
2. **コード骨格**: QUANTのバックテストパイプラインとARCHのPhase0Pipelineクラスを統合し、Phase 0のWeek 1-2で構築
3. **ステージゲート**: パイロット100件の結果でフル4,000件に進むか判断（DEVILの提案を採用）。精度55%未満ならフルテスト中止
4. **比較プロトコル**: McNemar検定によるモデル間比較。LLMプロンプト3種類での検証
5. **期限**: Phase 0は2週間で完了。Day 1-2: プロンプト設計、Day 3-5: データ収集、Day 6-8: LLM実行、Day 9: 時間バイアス検定、Day 10-12: ベースライン比較、Day 13-14: Go/No-Go判断

---

### ディベート7: テスト戦略

| | カバレッジ重視派 | テスト品質重視派 |
|---|---|---|
| **メンバー** | ARCH（条件付き） | DEVIL（主導）, QUANT |

**【DEVIL】** カバレッジ95%の罠を指摘する。95%カバレッジが保証するのは「コードの95%の行が最低1回実行された」ことだけだ。境界値のバグ（>=と>の混同）、状態遷移のバグ（回路ブレーカーの複雑な遷移）、並行性のバグ（ファイルロック）、データ品質のバグ（Alpaca APIのqtyが文字列）は検出されない。カバレッジの数字を上げるためにテストの質が低下する現象は頻繁に観察される。

**Mutation Testing**（コードの条件式を反転させてテストが失敗するかを検証）を導入すべき。少なくともリスク管理モジュールに適用。**プロパティベーステスト**（hypothesis等）も導入し、「ポジションサイズは常に0以上」「ストップロスは常にエントリー価格未満」等の不変条件をランダムデータで検証。

ペーパートレーディング最初の2週間を「カナリアリリース」として1ポジションのみで運用し、全ての注文を手動検証すべき。

**【QUANT】** 統計的テストもテスト戦略に含めるべき。McNemar検定、Brier Score、Hosmer-Lemeshow検定等の統計検定を自動化し、CIパイプラインに組み込む。パフォーマンス評価の統計的厳密性はユニットテストとは別の品質保証レイヤーだ。

**【ARCH】** 構造化ロギングとObservabilityでテストを補完する。JSON Lines形式のログでexecution_idによる横断的追跡を可能にし、メトリクスの異常検知（Claude CLIレスポンス時間が7日平均の2倍超過、シグナル頻度が30日平均の50%未満等）で予兆を検知する。

**結論**:

1. **カバレッジ目標の修正**: risk_managerは95%、その他は80%（DEVILの指摘に基づき不整合を修正）
2. **Mutation Testing**: リスク管理モジュールに適用（Phase 2で導入）
3. **プロパティベーステスト**: hypothesis等でリスク管理の不変条件を検証（Phase 2で導入）
4. **カナリアリリース**: ペーパートレーディング最初の2週間は1ポジション限定で手動検証
5. **統計的テストの自動化**: McNemar検定等をCIに組み込み
6. **Observability**: 構造化ログ+メトリクス収集+閾値ベース異常検知

---

## セクション4: クロスカッティング論点

### 論点A: v2からの未解決事項のフォロー

v2で残された7つの課題のうち、v3で進展があったものを記録する。

| v2残課題 | v3での進展 | 状況 |
|----------|-----------|------|
| LLMモデル変更リスク | STRATがマルチモデルアンサンブル（Claude+GPT+Gemini）をプランCの一部として提案。DEVILが6ヶ月ごとのLLM精度再テストを提案 | 部分的に解決 |
| 決算期間外の運用 | STRATが3段階アプローチ（決算ロングテール活用→マクロイベントドリブン→ガイダンス更新/アナリストレーティング変更シグナル）を提案。推定年間80-116シグナル | 具体化 |
| コスト上限と自動停止 | DEVILが$300中間レビューを追加提案（v2の$500上限に加えて） | 強化 |
| バーンアウト対策 | DEVILが複雑性削減（MVP思想）で間接的に対処。月次維持39h/月の見積もりで問題の深刻さを可視化 | 認識強化 |
| 税務戦略 | v3では未議論 | 未解決 |
| PDTルール | v3では未議論 | 未解決 |
| 企業アクション | v3では未議論 | 未解決 |

### 論点B: v3で新たに浮上した課題

1. **alpha decayの存在的リスク**: STRATとDEVILが独立して「LLMセンチメントのエッジは消失する」と指摘。v2では「注意書き」レベルだったものが、v3ではモニタリングフレームワーク（Edge Half-Life推定）とフォールバック（プランC）の設計にまで具体化。**プロジェクトの存在意義に関わる問題**として認識が深まった

2. **設計と実装の巨大なギャップ**: QUANTとARCHが共に「v2は設計書であり、実行可能な仕様ではない」と指摘。Phase 0のバックテスト、統計検定、検証ツールキットのコード骨格がゼロの状態。v3でPythonコード骨格が提案されたが、実装はまだ行われていない

3. **複雑性と個人開発者の限界**: DEVILが178h開発+39h/月の見積もりで問題を定量化。「やるべきことリスト」と「できることリスト」の乖離がv2最大の構造的問題

4. **Go/No-Go基準のコスト込み再計算**: DEVILが60%精度でのマイナスリターン（-1.4%）を計算。「Go基準が甘すぎて損をしながら走り続ける」リスクが顕在化

5. **ベイズ事前分布の恣意性**: DEVILが事前分布の選択で結論が操作可能であることを指摘。4つの事前分布での感度分析が必須に

6. **Reconciliationの「Alpaca=正」前提の脆弱性**: DEVILがAlpaca APIのバグ、レースコンディション、ネットワーク障害時の誤判定リスクを指摘。2回連続呼び出しによる整合性確認を提案

7. **サンクコスト効果の過小評価**: DEVILが800時間/$40,000の機会コスト後に「やめる」判断を人間の意志力に委ねることの非現実性を指摘。撤退判断のシステム化が必要

### 論点C: 5人の間の意見対立と合意形成パターン

v3の議論で観察された特徴的なパターンを記録する。

**パターン1: DEVIL vs 全員（建設的緊張）**
DEVILの指摘が「v2の前提を根本から問い直す」ものであったため、他の4人が「方向性は正しいが具体的な代替案が必要」と対応するパターンが頻発。特にGo/No-Go閾値（60→65%）の議論では、DEVILのコスト込み計算が説得力を持ち、他のメンバーが段階的に受け入れた。

**パターン2: STRAT-QUANT連携（エッジの検証と監視）**
STRATの「エッジはどこにあるか/いつまであるか」という問いと、QUANTの「それはバックテストで検証できるか」が相互に補完。alpha decayモニタリングではSTRATが定性的フレームワーク（プランC）、QUANTが定量的手法（MI分析）を提供。

**パターン3: RISK-ARCH連携（防御と実装）**
RISKが「最悪のシナリオ」を提示し、ARCHが「それ、実装できる」と具体的なコードで応答。ギャップリスクモデル→config.tomlのスリッページ係数テーブル、動的相関→EWMA実装、ストレステスト→ヒストリカルシミュレーションモジュール。

**パターン4: DEVILの「複雑性警告」による全体の軌道修正**
DEVILの178h/39h月の見積もりが議論の転換点となり、「必須/追加/リアル移行時」の3段階分類が合意された。v2の「網羅的だが実装不能」問題に対する最も効果的な対策。

---

## セクション5: 合意事項と未解決事項

### 全員一致の合意事項

1. **Go/No-Go基準の引き上げ**: 方向性精度の閾値を60%から65%に引き上げ。全ての判定において取引コスト込みネットリターンがプラスであることを確認する条件を追加

2. **Phase 0実行プロトコルの精緻化**: 時間バイアス検定、層化サンプリング、プロンプトバージョンロック、ステージゲート（パイロット100件→フル4,000件）、2週間の期限設定

3. **Alpha Decayモニタリング**: 月次精度トラッキングを初月から稼働。Edge Half-Life推定を6ヶ月後に実施。プランC（LLMをリスクフィルターに転用）を事前設計

4. **複雑性の3段階分類**: 「必須（Phase 1 MVP）」「追加（Phase 3）」「リアル移行時」の3段階で優先度付け。初期実装スコープの大幅縮小

5. **ベイズ事前分布の感度分析**: 4つの事前分布（懐疑的/中立的/楽観的/コスト調整済み）での感度分析を月次レポートに必須で含める。全てでP(SR>0.5)>90%の場合にのみリアル移行許可

6. **統計的検証手法の高度化**: Bonferroni→BH法FDR制御、PurgedTimeSeriesSplit導入、McNemar検定採用、MI分析によるフィルター最適化

7. **ストレステストの実データ化**: 5つのヒストリカルシナリオ（COVID-19、インフレショック、SVB危機、円キャリーアンワインド、フラッシュクラッシュ）で実データ再現テスト

8. **テスト戦略の質向上**: カバレッジ目標の修正（risk_manager 95%、その他80%）、Mutation Testing導入、プロパティベーステスト導入、カナリアリリース（2週間）

9. **撤退判断のシステム化**: 撤退基準抵触時にtrading_agent.pyが自動で新規エントリーを停止。再開には手動設定変更を要求。$300中間撤退レビューの追加

10. **型安全インターフェース**: types.pyにdataclasses + Protocolで全モジュールの入出力型を定義。Phase 1初期に構築

### 条件付き合意事項

1. **目標リターンのPhase 0結果に基づく再校正**: Kelly基準との整合性に疑義があるため、Phase 0で実績勝率とRR比が判明した時点でシナリオ別リターン早見表に照らして目標を再校正。年率8-12%は「暫定値」
   - **条件**: Phase 0完了後に確定

2. **動的相関管理の本格導入**: EWMA動的相関+相関ブレイクアウト警告+相関レジーム分類
   - **条件**: Phase 3以降。ペーパー6ヶ月後に静的 vs EWMAの事後比較で追加的価値を確認した場合

3. **マクロレジーム4変数モデルへの拡張**: イールドカーブ+クレジットスプレッドの追加
   - **条件**: 2変数モデルで3ヶ月運用後、レジーム判定の精度に問題がある場合に拡張

4. **テイクプロフィット幅の調整**: ATR x 3.0 → ATR x 4.0
   - **条件**: Phase 1の2ヶ月目にATR x 3.0の実績を確認後、「1変数ずつ」ルールに従い3ヶ月目に変更して比較

5. **Plattキャリブレーション/Isotonic Regression**: LLM確信度の補正
   - **条件**: 累計50件以上のデータ蓄積後にPlatt Scaling導入、100件以上でIsotonic Regressionへの切替を検討

6. **VPS移行タイミング**: ペーパー開始から3ヶ月以内
   - **条件**: macOSでの月間ジョブ欠落率が5%を超えた場合は即時移行（v2合意を維持）

### 未解決事項（今後の検討課題）

1. **税務戦略**: 短期キャピタルゲイン税（連邦税率最大37%）の影響。税引後リターンの目標設定、タックスロスハーベスティングの戦略設計。リアル移行前に検討必須

2. **PDTルール対応**: 口座残高$25,000未満の場合のデイトレード制限。スイングトレード（オーバーナイト保有）であれば適用されないが、システム設計で保証必要

3. **企業アクション対応**: 配当・株式分割・スピンオフへの対応。Alpaca APIの企業アクション通知の活用方法。Phase 3で具体化

4. **Reconciliation時の自動修正の閾値**: DEVILが指摘したAlpaca APIのバグ/レースコンディション問題。差異が3件以上の場合は自動修正停止、2回連続呼び出しの整合性確認、sourceカラムの追加。Phase 2で設計

5. **レジーム遷移のヒステリシス**: STRATが提案したレジーム確定に「3営業日連続で同一判定」を要求する仕組み。月間レジーム変更4回以上で閾値再キャリブレーション。Phase 3で実装

6. **セクターETF補完戦略のエッジ検証**: Phase 0と並行してセクターモメンタム戦略の過去3年バックテスト。SR<0.3ならETF戦略は不採用。Phase 0で判断

7. **limit付きstop orderの乖離幅**: RISKが提案したATRベースの乖離幅（ATR x 1.0）。エントリー価格の-8%を絶対フロアとする。Phase 0のストレステストで約定率を検証

8. **リアル移行時の回路ブレーカー閾値**: 一気に50%引き下げではなく段階的厳格化（75%→62.5%→50%）。ペーパートレーディング実績データで事前シミュレーション必須

---

## セクション6: v2→v3の主要変更点一覧

| # | 項目 | v2 | v3 | 変更理由 |
|---|------|----|----|---------|
| 1 | Go/No-Go閾値 | 方向性精度60% | 方向性精度65% | コスト込み計算でマイナスリターン回避 |
| 2 | Go判定追加条件 | なし | 取引コスト込みネットリターン>0% | DEVILのコスト計算に基づく |
| 3 | Phase 0サンプリング | ランダム100件 | 層化抽出100件+時間バイアス検定20件 | サンプリングバイアスとLLM事前知識汚染の排除 |
| 4 | Phase 0ステージゲート | なし | パイロット100件→Go判定→フル4,000件 | コスト効率化 |
| 5 | Phase 0期限 | 未定義 | 2週間 | 目的化リスクの回避 |
| 6 | 多重比較補正 | Bonferroni | BH法FDR制御 | Type IIエラー低減 |
| 7 | 時系列CV | TimeSeriesSplit | PurgedTimeSeriesSplit | データリーケージ防止 |
| 8 | ベイズ事前分布 | Normal(0, 0.5)単体 | 4つの事前分布で感度分析必須 | 事前分布の恣意性排除 |
| 9 | Alpha Decay対策 | 注意書きのみ | モニタリングFW+Edge Half-Life+プランC | 存在的リスクへの構造的対応 |
| 10 | プランC | なし | LLMをリスクフィルターに転用 | エッジ枯渇時の代替戦略 |
| 11 | 実装優先度 | 全機能並列 | 3段階分類（必須/追加/リアル移行時） | 複雑性削減、MVP思想 |
| 12 | 初期マクロモデル | 4変数 | 2変数で開始→必要時に4変数拡張 | MVP思想に基づくスコープ縮小 |
| 13 | ストレステスト | 仮定ベース4シナリオ | ヒストリカル実データ5シナリオ | 最悪ケースの過小評価防止 |
| 14 | テストカバレッジ | 全体95% | risk_manager 95%、その他80% | カバレッジ罠の回避 |
| 15 | テスト手法 | ユニットテスト中心 | +Mutation Testing+プロパティベーステスト | テスト品質の向上 |
| 16 | カナリアリリース | なし | 最初の2週間を1ポジション限定 | 実環境での手動検証 |
| 17 | 撤退判断 | 月次チェックポイント（人間判断） | システムが自動停止+手動再開要求 | サンクコスト効果への対抗 |
| 18 | 中間レビュー | $500コスト上限 | +$300中間撤退レビュー | 早期の撤退判断機会 |
| 19 | モデル間比較 | カイ二乗検定 | McNemar検定 | ペアデータ比較の適切性 |
| 20 | シグナル情報量 | 未分析 | MI/CMI分析でフィルター最適化 | 冗長フィルターの除去 |
| 21 | 型安全性 | 未定義 | types.py（dataclasses+Protocol） | 運用品質とテスタビリティ |
| 22 | Claude CLI出力 | json.loads()のみ | JSON Schema Validation+フォールバック | LLM出力の信頼性確保 |
| 23 | 相関管理（初期） | 相関マトリクス月次更新 | セクター2銘柄制限（MVP） | 複雑性削減 |
| 24 | 相関管理（将来） | 静的相関 | EWMA動的相関+相関ブレイクアウト警告 | 危機時の相関収束対応 |
| 25 | 回路ブレーカー厳格化 | 一気に50%引き下げ | Stage別段階的厳格化（75%→62.5%→50%） | 過敏すぎる発動の防止 |

---

*レビュー実施: STRAT, QUANT, RISK, ARCH, DEVIL*
*レビュー日: 2026-02-11*
*対象文書: docs2/strategy.md, docs2/system-design.md, docs2/action-plan.md, docs2/planning-log.md, 各メンバーのv2レビュー*
