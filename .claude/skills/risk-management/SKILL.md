---
name: risk-management
description: |
  トレーディングにおけるリスク管理を体系的に行うためのスキル。
  以下のキーワードでトリガーする：「リスク管理」「ポジションサイズ」「ストップロス」
  「損切り」「ドローダウン」「破産確率」「資金管理」「マネーマネジメント」
  「ケリー基準」「Kelly Criterion」「最大損失」「リスクリワード」「回路ブレーカー」
  「リスク許容度」「エクスポージャー」。
  トレーディング戦略の設計・レビュー・実行時に必ず使用すること。
  リスク管理なしのトレーディングは絶対に許可してはならない。
---

# リスク管理スキル

## このスキルの目的

トレーディングにおけるリスクを体系的に管理し、破滅的な損失を防止せよ。

> **「まず生き残れ。儲けるのはその後だ」** — George Soros

## なぜリスク管理が最重要か

### リスク管理なしのトレーディングはなぜ破滅するか：数学的説明

```
例: 勝率50%、勝ちは+10%、負けは-10%の戦略

一見すると期待値ゼロに見えるが、資金に対する比率で考えると:
$100 × 1.10 × 0.90 = $99（1勝1敗で資金が減る）

これは「ボラティリティの減衰（volatility drag）」と呼ばれる。
資金の大きな比率をリスクにさらすほど、この効果は大きくなる。

さらに問題なのは連続損失:
$100 → -10% → $90 → -10% → $81 → -10% → $72.9
→ 3連敗で27%の損失。回復に37%の利益が必要。

$100 → -50% → $50
→ 50%の損失。回復に100%の利益が必要（ほぼ不可能）。
```

**教訓**: 大きな損失は回復が指数関数的に困難になる。だからリスク管理で「大きな損失を防ぐ」ことが最優先。

## 最低限守るべきリスクルール一覧

### 絶対に破ってはならないルール

| # | ルール | 基準 | 理由 |
|---|--------|------|------|
| 1 | 1トレードの最大リスク | 総資金の1-2% | 連続損失に耐えるため |
| 2 | 1日の最大損失 | 総資金の5% | 感情的取引を防ぐため |
| 3 | 最大同時ポジション数 | 5-10 | 集中リスクを防ぐため |
| 4 | 最大ドローダウン | 総資金の15-20% | 破産を防ぐため |
| 5 | 全ポジションにストップロス | 必須 | 想定外の損失を防ぐため |
| 6 | レバレッジ制限 | 最大2倍（初期は1倍） | 損失の増幅を防ぐため |

### 回路ブレーカー（Circuit Breaker）

```
以下の条件を満たしたら、自動的に全ポジションをクローズし、
新規取引を停止せよ:

Level 1: 日次損失が3%超
→ 新規エントリー停止。既存ポジションは保持。
→ 翌日再開。

Level 2: 日次損失が5%超
→ 全ポジションクローズ。翌日再開。
→ ポジションサイズを50%に縮小して再開。

Level 3: 月次損失が10%超
→ 全ポジションクローズ。1週間停止。
→ 戦略の全面レビューを実施してから再開。

Level 4: 総ドローダウンが15%超
→ 全ポジションクローズ。無期限停止。
→ 戦略の根本的な見直しが完了するまで再開しない。
```

## ポジションサイズの決定

**詳細は [references/position-sizing.md](references/position-sizing.md) を参照。**

### クイックリファレンス: 最大リスク比率法（推奨）

```python
def calculate_position_size(
    total_capital,     # 総資金
    risk_per_trade,    # 1トレードのリスク比率（例: 0.02 = 2%）
    entry_price,       # エントリー価格
    stop_loss_price    # ストップロス価格
):
    """ポジションサイズを計算する"""
    risk_amount = total_capital * risk_per_trade
    risk_per_share = abs(entry_price - stop_loss_price)
    shares = int(risk_amount / risk_per_share)
    return shares

# 例: 資金$100,000、リスク2%、エントリー$150、ストップ$145
shares = calculate_position_size(100000, 0.02, 150, 145)
# = int(2000 / 5) = 400株
# ポジション金額: 400 × $150 = $60,000（資金の60%）
# 最大損失: 400 × $5 = $2,000（資金の2%）✅
```

## ストップロス戦略

**詳細は [references/stop-loss-strategies.md](references/stop-loss-strategies.md) を参照。**

## ポートフォリオレベルのリスク管理

**詳細は [references/portfolio-risk.md](references/portfolio-risk.md) を参照。**

## リスク管理チェックリスト

戦略を稼働させる前に必ず確認せよ：

### エントリー前
- [ ] ポジションサイズは計算されているか（直感ではなく）
- [ ] ストップロスは設定されているか
- [ ] リスクリワード比率は1:2以上か
- [ ] 同時ポジション数の上限を超えていないか
- [ ] セクター集中度は許容範囲内か
- [ ] 当日の最大損失に達していないか

### 運用中
- [ ] 回路ブレーカーの条件は実装されているか
- [ ] ドローダウンのモニタリングは自動化されているか
- [ ] ストップロスが正しく動作するかテスト済みか
- [ ] API障害時にポジションが放置されない仕組みがあるか

### レビュー時
- [ ] 実際のスリッページは想定内か
- [ ] 最大ドローダウンは許容範囲内だったか
- [ ] リスクルールは一度も破られなかったか
- [ ] 破られた場合、なぜ破られたかの分析はしたか

## アンチパターン

```
❌ 「損切りはもったいない。もう少し待てば戻るかも」
→ 希望は戦略ではない。ストップロスは絶対。

❌ 「この銘柄は自信があるから、ポジション大きめにしよう」
→ 自信とリスク管理は無関係。ルールに従え。

❌ 「連続で負けたから、次は大きく張って取り返す」
→ マーチンゲール思考。破産への最短ルート。

❌ 「バックテストで最大ドローダウン8%だったから、
   リアルでもそれくらいだろう」
→ リアルのドローダウンはバックテストの2-3倍になることが多い。
   バックテストで8%なら、リアルでは15-20%を想定せよ。
```
