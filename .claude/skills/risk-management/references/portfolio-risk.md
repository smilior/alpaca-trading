# ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªãƒªã‚¹ã‚¯ç®¡ç† ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

## ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªãƒ¬ãƒ™ãƒ«ã®ãƒªã‚¹ã‚¯ç®¡ç†

å€‹åˆ¥ãƒˆãƒ¬ãƒ¼ãƒ‰ã®ãƒªã‚¹ã‚¯ç®¡ç†ã ã‘ã§ã¯ä¸ååˆ†ã€‚ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªå…¨ä½“ã®ãƒªã‚¹ã‚¯ã‚’ç®¡ç†ã›ã‚ˆã€‚

## ç®¡ç†ã™ã¹ããƒªã‚¹ã‚¯è¦ç´ 

### 1. æœ€å¤§åŒæ™‚ãƒã‚¸ã‚·ãƒ§ãƒ³æ•°

```
æ¨å¥¨:
- åˆæœŸæ®µéš: 3ãƒã‚¸ã‚·ãƒ§ãƒ³ã¾ã§
- å®‰å®šé‹ç”¨: 5-8ãƒã‚¸ã‚·ãƒ§ãƒ³
- ä¸Šé™: 10ãƒã‚¸ã‚·ãƒ§ãƒ³

ç†ç”±:
- å°‘ãªã™ãã‚‹ï¼ˆ1-2ï¼‰: å€‹åˆ¥éŠ˜æŸ„ãƒªã‚¹ã‚¯ãŒå¤§ãã™ãã‚‹
- å¤šã™ãã‚‹ï¼ˆ15+ï¼‰: ç®¡ç†ãŒå›°é›£ã€æ‰‹æ•°æ–™ï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ï¼‰ã®ç´¯ç©
- 5-8ãŒç®¡ç†å¯èƒ½æ€§ã¨åˆ†æ•£ã®ãƒãƒ©ãƒ³ã‚¹ãŒæœ€è‰¯
```

### 2. ã‚»ã‚¯ã‚¿ãƒ¼é›†ä¸­ãƒªã‚¹ã‚¯

```
ãƒ«ãƒ¼ãƒ«: åŒä¸€ã‚»ã‚¯ã‚¿ãƒ¼ã¸ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¯
       ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã®40%ä»¥ä¸‹

âŒ æ‚ªã„ä¾‹:
AAPL 25% + MSFT 20% + GOOG 20% + NVDA 20% + META 15%
â†’ ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ã‚»ã‚¯ã‚¿ãƒ¼100%ã€‚åˆ†æ•£ã«ãªã£ã¦ã„ãªã„ã€‚

âœ… è‰¯ã„ä¾‹:
AAPL 15% + JPM 15% + JNJ 15% + XOM 15% + AMZN 15% + ç¾é‡‘25%
â†’ 4ã‚»ã‚¯ã‚¿ãƒ¼ã«åˆ†æ•£ + ç¾é‡‘ãƒãƒƒãƒ•ã‚¡ãƒ¼
```

### 3. ç›¸é–¢ãƒªã‚¹ã‚¯

ç•°ãªã‚‹ã‚»ã‚¯ã‚¿ãƒ¼ã§ã‚‚ç›¸é–¢ãŒé«˜ã„å ´åˆã€åˆ†æ•£åŠ¹æœãŒä½ã„ã€‚

```python
import pandas as pd
import numpy as np

def check_correlation(returns_df, threshold=0.7):
    """ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã®ç›¸é–¢ã‚’ãƒã‚§ãƒƒã‚¯"""
    corr_matrix = returns_df.corr()

    high_corr_pairs = []
    symbols = corr_matrix.columns
    for i in range(len(symbols)):
        for j in range(i+1, len(symbols)):
            if abs(corr_matrix.iloc[i, j]) > threshold:
                high_corr_pairs.append({
                    'pair': f"{symbols[i]} - {symbols[j]}",
                    'correlation': corr_matrix.iloc[i, j]
                })

    return high_corr_pairs

# ç›¸é–¢ > 0.7 ã®ãƒšã‚¢ãŒè¦‹ã¤ã‹ã£ãŸã‚‰ã€
# ã©ã¡ã‚‰ã‹ä¸€æ–¹ã®ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚’ç¸®å°ã™ã‚‹ã“ã¨ã‚’æ¤œè¨
```

### 4. æœ€å¤§ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ç®¡ç†

```
ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ = (ãƒ”ãƒ¼ã‚¯å€¤ - ç¾åœ¨å€¤) / ãƒ”ãƒ¼ã‚¯å€¤

ä¾‹:
ãƒ”ãƒ¼ã‚¯: $120,000
ç¾åœ¨: $108,000
ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³: ($120,000 - $108,000) / $120,000 = 10%
```

```python
def calculate_drawdown(equity_curve):
    """ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ã‚’è¨ˆç®—"""
    peak = equity_curve.cummax()
    drawdown = (equity_curve - peak) / peak
    max_drawdown = drawdown.min()
    return drawdown, max_drawdown
```

**è¨±å®¹åŸºæº–**:
| æ®µéš | æœ€å¤§ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³è¨±å®¹å€¤ |
|------|----------------------|
| ãƒšãƒ¼ãƒ‘ãƒ¼ãƒˆãƒ¬ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° | 20%ï¼ˆå­¦ç¿’ã®ãŸã‚ç·©ã‚ï¼‰ |
| ãƒªã‚¢ãƒ«åˆæœŸ | 10% |
| ãƒªã‚¢ãƒ«å®‰å®šé‹ç”¨ | 15% |
| çµ¶å¯¾ä¸Šé™ | 20%ï¼ˆã“ã‚Œã‚’è¶…ãˆãŸã‚‰å…¨åœæ­¢ï¼‰ |

### 5. æ—¥æ¬¡æœ€å¤§æå¤±ãƒ«ãƒ¼ãƒ«

```
ãƒ«ãƒ¼ãƒ«:
1æ—¥ã®æå¤±ãŒç·è³‡é‡‘ã®3%ã«é”ã—ãŸã‚‰ â†’ æ–°è¦ã‚¨ãƒ³ãƒˆãƒªãƒ¼åœæ­¢
1æ—¥ã®æå¤±ãŒç·è³‡é‡‘ã®5%ã«é”ã—ãŸã‚‰ â†’ å…¨ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚¯ãƒ­ãƒ¼ã‚º

ãªãœå¿…è¦ã‹:
- ç•°å¸¸ãªå¸‚å ´ç’°å¢ƒï¼ˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ç­‰ï¼‰ã§ã®è¢«å®³ã‚’é™å®š
- 1æ—¥ã§å–ã‚Šè¿”ã›ãªã„æå¤±ã‚’é˜²ã
- ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®èª¤å‹•ä½œã«ã‚ˆã‚‹é€£é–çš„ãªæå¤±ã‚’é˜²ã
```

### 6. é€£ç¶šæå¤±æ™‚ã®ãƒ«ãƒ¼ãƒ«ï¼ˆå›è·¯ãƒ–ãƒ¬ãƒ¼ã‚«ãƒ¼ï¼‰

```
é€£ç¶š5å›ã®æå¤±:
â†’ ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚µã‚¤ã‚ºã‚’50%ã«ç¸®å°
â†’ æ¬¡ã®3å›ã®å–å¼•çµæœã‚’è©•ä¾¡
  â†’ 2å‹ä»¥ä¸Š: é€šå¸¸ã‚µã‚¤ã‚ºã«å¾©å¸°
  â†’ 2å‹æœªæº€: ã•ã‚‰ã«50%ç¸®å°ï¼ˆå…ƒã®25%ï¼‰
  â†’ å…ƒã®25%ã§ã‚‚é€£æ•—ãŒç¶šã: æˆ¦ç•¥åœæ­¢ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼

ç†ç”±:
é€£ç¶šæå¤±ã¯ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã‚’ç¤ºå”†ã™ã‚‹:
1. å¸‚å ´ç’°å¢ƒã®å¤‰åŒ–ï¼ˆãƒ¬ã‚¸ãƒ¼ãƒ ãƒã‚§ãƒ³ã‚¸ï¼‰
2. æˆ¦ç•¥ã®å‰æãŒå´©ã‚Œã¦ã„ã‚‹
3. ãŸã¾ãŸã¾ï¼ˆç¢ºç‡çš„ã«èµ·ã“ã‚Šã†ã‚‹ï¼‰

1,2ã®å ´åˆã¯ç¸®å°ã—ã¦è¢«å®³ã‚’é™å®šã™ã¹ãã€‚
3ã®å ´åˆã¯ç¸®å°ã—ã¦ã‚‚é•·æœŸçš„ã«å•é¡Œãªã„ã€‚
â†’ ã‚ˆã£ã¦ç¸®å°ãŒåˆç†çš„ã€‚
```

## ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªãƒªã‚¹ã‚¯ã®çµ±åˆãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

```python
class PortfolioRiskMonitor:
    """ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªãƒªã‚¹ã‚¯ã®ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°"""

    def __init__(self, config):
        self.max_positions = config.get('max_positions', 5)
        self.max_sector_pct = config.get('max_sector_pct', 0.40)
        self.max_daily_loss_pct = config.get('max_daily_loss_pct', 0.05)
        self.max_drawdown_pct = config.get('max_drawdown_pct', 0.15)
        self.max_correlation = config.get('max_correlation', 0.7)

    def check_new_trade(self, portfolio, new_trade):
        """æ–°ã—ã„ãƒˆãƒ¬ãƒ¼ãƒ‰ãŒè¨±å¯ã•ã‚Œã‚‹ã‹ãƒã‚§ãƒƒã‚¯"""
        violations = []

        # ãƒã‚¸ã‚·ãƒ§ãƒ³æ•°ãƒã‚§ãƒƒã‚¯
        if len(portfolio.positions) >= self.max_positions:
            violations.append(
                f"æœ€å¤§ãƒã‚¸ã‚·ãƒ§ãƒ³æ•°è¶…é: {len(portfolio.positions)}/{self.max_positions}"
            )

        # ã‚»ã‚¯ã‚¿ãƒ¼é›†ä¸­ãƒã‚§ãƒƒã‚¯
        sector = new_trade.sector
        sector_exposure = portfolio.get_sector_exposure(sector)
        new_exposure = sector_exposure + new_trade.value / portfolio.total_value
        if new_exposure > self.max_sector_pct:
            violations.append(
                f"ã‚»ã‚¯ã‚¿ãƒ¼é›†ä¸­: {sector} = {new_exposure:.1%} > {self.max_sector_pct:.1%}"
            )

        # æ—¥æ¬¡æå¤±ãƒã‚§ãƒƒã‚¯
        if portfolio.daily_pnl / portfolio.total_value < -self.max_daily_loss_pct:
            violations.append(
                f"æ—¥æ¬¡æå¤±ä¸Šé™åˆ°é”: {portfolio.daily_pnl_pct:.1%}"
            )

        # ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ãƒã‚§ãƒƒã‚¯
        if portfolio.current_drawdown < -self.max_drawdown_pct:
            violations.append(
                f"æœ€å¤§ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³è¶…é: {portfolio.current_drawdown:.1%}"
            )

        return {
            'allowed': len(violations) == 0,
            'violations': violations
        }
```

## ãƒªã‚¹ã‚¯ç®¡ç†ãƒ¬ãƒãƒ¼ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```markdown
## æ—¥æ¬¡ãƒªã‚¹ã‚¯ãƒ¬ãƒãƒ¼ãƒˆ [æ—¥ä»˜]

### ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæ¦‚è¦
- ç·è³‡ç”£: $[é‡‘é¡]
- å½“æ—¥æç›Š: $[é‡‘é¡] ([%])
- å‰æ—¥æ¯”: [+/-]

### ãƒªã‚¹ã‚¯æŒ‡æ¨™
| æŒ‡æ¨™ | ç¾åœ¨å€¤ | ä¸Šé™ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|------|--------|------|----------|
| åŒæ™‚ãƒã‚¸ã‚·ãƒ§ãƒ³æ•° | x/y | y | âœ…/âš ï¸/ğŸš¨ |
| æ—¥æ¬¡æå¤± | x% | 5% | âœ…/âš ï¸/ğŸš¨ |
| ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ | x% | 15% | âœ…/âš ï¸/ğŸš¨ |
| æœ€å¤§ã‚»ã‚¯ã‚¿ãƒ¼é›†ä¸­ | x% | 40% | âœ…/âš ï¸/ğŸš¨ |

### ã‚»ã‚¯ã‚¿ãƒ¼é…åˆ†
| ã‚»ã‚¯ã‚¿ãƒ¼ | ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¸ãƒ£ãƒ¼ | ä¸Šé™ |
|----------|----------------|------|
| [ã‚»ã‚¯ã‚¿ãƒ¼å] | [%] | 40% |

### ã‚¢ãƒ©ãƒ¼ãƒˆ
- [ã‚ã‚Œã°è¨˜è¼‰]
```
